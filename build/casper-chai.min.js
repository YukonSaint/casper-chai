(function(){var t,e=[].slice,n={}.hasOwnProperty,r=function(t,e){for(var r in e){if(n.call(e,r))t[r]=e[r]}function i(){this.constructor=t}i.prototype=e.prototype;t.prototype=new i;t.__super__=e.prototype;return t};t=function(t,n){var i,o,s,a,u,c,h,p,l,f,d,b,m,y,v;l=t.assert;o=t.Assertion;f=n.flag;c=function(){function t(t,e){var n=this;this.casper=t;this.definition=e;Object.defineProperty(this,"length",{get:function(){var t;t=function(t){return __utils__.findAll(t).length};return n.casper.evaluate(t,{_selector:n.definition})}});this.isRemoteSelector=true}t.prototype.map=function(t,e){var n,r;r=function(t,e,n){var r,i;r=__utils__.findAll(t);i=[];Array.prototype.forEach.call(r,function(t){return i.push(e.apply(t,n))});return i};n=this.casper.evaluate(r,{_selector:this.definition,_fn:t,_args:e});return n};t.prototype.attrs=function(t){var e,n;n=function(t){return this.getAttribute(t)};e=this.map(n,[t]);return e};t.prototype.tagnames=function(){return this.map(function(){return this.tagName})};return t}();a=function(){function t(t,e){this.chai=t;this.casper=e}t.prototype.method=function(){};t.addToChai=function(t){var r,i,s;r=new t;if(_.isFunction(r["chainMethod"])){i=function(){var n,i;n=1<=arguments.length?e.call(arguments,0):[];i=f(this,"object");r=new t(this,i);return r.chainMethod.apply(r,n)};s=function(){var n,i;n=1<=arguments.length?e.call(arguments,0):[];i=f(this,"object");r=new t(this,i);return r.method.apply(r,n)};return n.addChainableMethod(o.prototype,r.name,s,i)}};t.prototype.test_against_selector=function(t,e,n){var r;r=this.get_selector();if(f(this.chai,"always")){this.chai.assert(_.all(t,e),"Expected all elements matching "+r.definition+" to have "+n+" but at least one did not")}else{this.chai.assert(_.any(t,e),"Expected an element matching "+r.definition+" to have "+n+" but none did")}if(f(this.chai,"one")){return this.chai.assert(_.filter(t,e).length===1,"Expected only one element matching "+r.definition+" to "+n+" but more than one did")}};t.prototype.get_selector=function(){var t;t=f(this.chai,"object");if(!t.isRemoteSelector){t=new c(this.casper,"html")}return t};return t}();b=function(e,n){return;return t.Assertion.addProperty(e,n)};d=function(e,n){return;return t.Assertion.addMethod(e,n)};m=function(t){var e;if(_.isFunction(t)){e=t}else if(_.isString(t)){if(/^\s*function\s+/.test(t)){e=t}else{if(t.indexOf("return ")===-1){e="function () { return "+t+" }"}else{e="function () { "+t+" }"}}}else{this.assert(false,"Expression "+t+" must be a function, or a string")}return e};v=function(t,e,n){var r;if(n==null){n=false}if(typeof t==="string"){r=new RegExp("^"+t+"$")}else if(_.isRegExp(t)){r=t}else if(n){if(toString.call(e)==="[object RuntimeArray]"){e=_.toArray(e)}return _.isEqual(t,e)}else{throw new Error("Test received "+t+", but expected string",+" or regular expression.")}return r.test(e)};y=function(t,e,n){var r,i;i=function(t,e){var n,r;r=__utils__.findAll(t);n=[];Array.prototype.forEach.call(r,function(t){return n.push(t.getAttribute(e))});return n};r=casper.evaluate(i,{_selector:t,_attr:e});return r};s=function(t){r(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.name="attr";e.prototype.chainMethod=function(){};e.prototype.method=function(t){var e,n,r;n=this.get_selector();e=n.attrs(t);r=function(t){return t};this.test_against_selector(e,r,'attribute "'+t+'"');return f(this.chai,"object",e)};return e}(a);a.addToChai(s);p=function(t){r(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.name="tagName";e.prototype.chainMethod=function(){};e.prototype.method=function(t){if(_.isString(t)){return t=[t]}else if(!_.isArray(t)){return l.ok(false,"tagName must be a string or list, it was "+typeof t)}};return e}(a);a.addToChai(p);u=function(t){r(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.name="one";e.prototype.chainMethod=function(){return f(this.chai,"one",true)};return e}(a);a.addToChai(u);i=function(t){r(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.name="always";e.prototype.chainMethod=function(){return f(this.chai,"always",true)};return e}(a);a.addToChai(i);h=function(t){r(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.name="selector";e.prototype.chainMethod=function(t){};e.prototype.method=function(t){return f(this.chai,"object",new c(this.casper,t))};return e}(a);a.addToChai(h);d("attr",function(t){var e,n,r;r=this._obj;n=y(r,t);l.equal(n.length,1,"Expected "+r+" to have one match, but it had "+n.length);e=n[0];return this.assert(e,"Expected selector "+r+" to have attribute "+t+", but it did not","Expected selector "+r+" to not have attribute "+t+", "+("but it was "+e))});d("attrAny",function(t){var e,n;n=this._obj;e=y(n,t);return this.assert(_.any(e),"Expected one element matching selector "+n+" to have attribute"+(""+t+" set, but none did"),"Expected no elements matching selector "+n+" to have attribute"+(""+t+" set, but at least one did"))});d("attrAll",function(t){var e,n;n=this._obj;e=y(n,t);return this.assert(_.all(e),"Expected all elements matching selector "+n+" to have attribute"+(""+t+" set, but one did not have it"),"Expected one elements matching selector "+n+" to not have "+(" attribute "+t+" set, but they all had it"))});d("fieldValue",function(t){var e,n,r;r=this._obj;if(_.isString(r)){}else{expect(r).to.be.inDOM}e=function(t){return __utils__.getFieldValue(t)};n=casper.evaluate(e,{selector:r});return this.assert(n===t,"expected field(s) "+r+" to have value "+t+", "+("but it was "+n),"expected field(s) "+r+" to not have value "+t+", "+"but it was")});b("inDOM",function(){var t;t=this._obj;return this.assert(casper.exists(t),"expected selector #{this} to be in the DOM, but it was not","expected selector #{this} to not be in the DOM, but it was")});b("loaded",function(){var t;t=this._obj;return this.assert(casper.resourceExists(t),"expected resource #{this} to exist, but it does not","expected resource #{this} to not exist, but it does")});d("matchOnRemote",function(t){var e,n,r;e=this._obj;n=m(e);r=casper.evaluate(n);return this.assert(v(t,r,true),"expected "+this._obj+" ("+n+" = "+r+") to match "+t,"expected "+this._obj+" ("+n+") to not match "+t+", but it did")});b("matchTitle",function(){var t,e;t=this._obj;e=casper.getTitle();return this.assert(v(t,e),"expected title #{this} to match #{exp}, but it did not","expected title #{this} to not match #{exp}, but it did")});b("matchCurrentUrl",function(){var t,e;e=this._obj;t=casper.getCurrentUrl();return this.assert(v(e,t),"expected url #{exp} to match #{this}, but it did not","expected url #{exp} to not match #{this}, but it did")});d("tagName",function(t){var e,n,r,i;n=this._obj;if(_.isString(t)){t=[t]}else if(!_.isArray(t)){l.ok(false,"tagName must be a string or list, it was "+typeof t)}i=function(t){var e,n;e=function(t,e){var n,r;n=__utils__.findAll(t);r=[];Array.prototype.forEach.call(n,function(t){return r.push(t.tagName.toLowerCase())});return r};n=casper.evaluate(e,{_selector:t});return n};r=i(n);e=_.difference(r,t);return this.assert(e.length===0,"Expected "+n+" to have only tags "+t+", but there was"+("tag(s) "+e+" appeared"),"Expected "+n+" to have tags other than "+t+", but "+"those were the only tags that appeared")});b("textInDOM",function(){var t,e;e=this._obj;t=casper.evaluate(function(){return document.body.textContent||document.body.innerText});return this.assert(t.indexOf(e)!==-1,"expected text #{this} to be in the document, but it was not","expected text #{this} to not be in the document, but it was found")});d("textMatch",function(t){var e,n;e=this._obj;n=casper.fetchText(e);return this.assert(v(t,n),"expected '"+e+"' to match "+t+', but it was "'+n+'"',"expected '"+e+"' to not match "+t+", but it did")});b("trueOnRemote",function(){var t,e,n;t=this._obj;e=m(t);n=casper.evaluate(e);return this.assert(n,"expected expression "+this._obj+" to be true, but it was "+n,"expected expression "+this._obj+" to not be true, but itw as "+n)});return b("visible",function(){var t;t=this._obj;expect(t).to.be.inDOM;return this.assert(casper.visible(t),"expected selector #{this} to be visible, but it was not","expected selector #{this} to not be, but it was")})};if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){module.exports=t}else if(typeof define==="function"&&define.amd){define(function(){return t})}else{chai.use(t)}}).call(this);