(function(){var t,e=[].slice,r={}.hasOwnProperty,n=function(t,e){for(var n in e){if(r.call(e,n))t[n]=e[n]}function o(){this.constructor=t}o.prototype=e.prototype;t.prototype=new o;t.__super__=e.prototype;return t};t=function(t,r){var o,i,s,a,u,c,h,l,p,f,d;u=t.assert;o=t.Assertion;c=r.flag;s=function(){function t(t,e){this.chai=t;this.casper=e}t.prototype.test=function(){throw new Error("CasperTest::test must be overloaded.")};t.addToChai=function(t){var n,i,s;n=new t;if(_.isFunction(n["chainMethod"])){i=function(){var r,o;r=1<=arguments.length?e.call(arguments,0):[];o=c(this,"object");n=new t(this,o);return n.chainMethod.apply(n,r)};s=function(){var r,o;r=1<=arguments.length?e.call(arguments,0):[];o=c(this,"object");n=new t(this,o);return n.method.apply(n,r)};return r.addChainableMethod(o.prototype,n.name,s,i)}};t.prototype.selector_map=function(t,e,r){var n,o;o=function(t,e,r){var n,o;n=__utils__.findAll(t);o=[];console.log("Args: "+r);Array.prototype.forEach.call(n,function(t){return _casper_attrs.push(e.apply(t,r))});return o};console.log("fn: "+e+", selector: "+t+", args: "+r);n=this.casper.evaluate(o,{_selector:t,_fn:e,_args:r});return n};t.prototype.chain_selector=function(t){if(_.isUndefined(t)){return c(this.chai,"casper-selector")}return c(this.chai,"casper-selector",t)};t.prototype.chain_attrs=function(t){if(_.isUndefined(t)){return c(this.chai,"casper-attrs")}return c(this.chai,"casper-attrs",t)};t.prototype.get_attrs=function(t,e){var r;r=function(t){console.log("ATTR: "+t+", this: "+this);return this.getAttribute(t)};return this.selector_map(t,r,[e])};t.prototype.get_tagnames=function(t){return this.selector_map(t,function(){return this[0].tagName})};return t}();l=function(e,r){return;return t.Assertion.addProperty(e,r)};h=function(e,r){return;return t.Assertion.addMethod(e,r)};p=function(t){var e;if(_.isFunction(t)){e=t}else if(_.isString(t)){if(/^\s*function\s+/.test(t)){e=t}else{if(t.indexOf("return ")===-1){e="function () { return "+t+" }"}else{e="function () { "+t+" }"}}}else{this.assert(false,"Expression "+t+" must be a function, or a string")}return e};d=function(t,e,r){var n;if(r==null){r=false}if(typeof t==="string"){n=new RegExp("^"+t+"$")}else if(_.isRegExp(t)){n=t}else if(r){if(toString.call(e)==="[object RuntimeArray]"){e=_.toArray(e)}return _.isEqual(t,e)}else{throw new Error("Test received "+t+", but expected string",+" or regular expression.")}return n.test(e)};f=function(t,e,r){var n,o;o=function(t,e){var r,n;n=__utils__.findAll(t);r=[];Array.prototype.forEach.call(n,function(t){return r.push(t.getAttribute(e))});return r};n=casper.evaluate(o,{_selector:t,_attr:e});return n};i=function(t){n(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.name="attr";e.prototype.chainMethod=function(t){};e.prototype.method=function(t){var e;e=this.get_attrs(this.chain_selector(),t);console.log("ABC := "+t);return"XYZ"};return e}(s);s.addToChai(i);a=function(t){n(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.name="selector";e.prototype.chainMethod=function(t){console.log("Chain... "+t);return this.chain_selector(t)};e.prototype.method=function(t){console.log("Sslector "+t);return this.chain_selector(t)};return e}(s);s.addToChai(a);h("attr",function(t){var e,r,n;n=this._obj;r=f(n,t);u.equal(r.length,1,"Expected "+n+" to have one match, but it had "+r.length);e=r[0];return this.assert(e,"Expected selector "+n+" to have attribute "+t+", but it did not","Expected selector "+n+" to not have attribute "+t+", "+("but it was "+e))});h("attrAny",function(t){var e,r;r=this._obj;e=f(r,t);return this.assert(_.any(e),"Expected one element matching selector "+r+" to have attribute"+(""+t+" set, but none did"),"Expected no elements matching selector "+r+" to have attribute"+(""+t+" set, but at least one did"))});h("attrAll",function(t){var e,r;r=this._obj;e=f(r,t);return this.assert(_.all(e),"Expected all elements matching selector "+r+" to have attribute"+(""+t+" set, but one did not have it"),"Expected one elements matching selector "+r+" to not have "+(" attribute "+t+" set, but they all had it"))});h("fieldValue",function(t){var e,r,n;n=this._obj;if(_.isString(n)){}else{expect(n).to.be.inDOM}e=function(t){return __utils__.getFieldValue(t)};r=casper.evaluate(e,{selector:n});return this.assert(r===t,"expected field(s) "+n+" to have value "+t+", "+("but it was "+r),"expected field(s) "+n+" to not have value "+t+", "+"but it was")});l("inDOM",function(){var t;t=this._obj;return this.assert(casper.exists(t),"expected selector #{this} to be in the DOM, but it was not","expected selector #{this} to not be in the DOM, but it was")});l("loaded",function(){var t;t=this._obj;return this.assert(casper.resourceExists(t),"expected resource #{this} to exist, but it does not","expected resource #{this} to not exist, but it does")});h("matchOnRemote",function(t){var e,r,n;e=this._obj;r=p(e);n=casper.evaluate(r);return this.assert(d(t,n,true),"expected "+this._obj+" ("+r+" = "+n+") to match "+t,"expected "+this._obj+" ("+r+") to not match "+t+", but it did")});l("matchTitle",function(){var t,e;t=this._obj;e=casper.getTitle();return this.assert(d(t,e),"expected title #{this} to match #{exp}, but it did not","expected title #{this} to not match #{exp}, but it did")});l("matchCurrentUrl",function(){var t,e;e=this._obj;t=casper.getCurrentUrl();return this.assert(d(e,t),"expected url #{exp} to match #{this}, but it did not","expected url #{exp} to not match #{this}, but it did")});h("tagName",function(t){var e,r,n,o;r=this._obj;if(_.isString(t)){t=[t]}else if(!_.isArray(t)){u.ok(false,"tagName must be a string or list, it was "+typeof t)}o=function(t){var e,r;e=function(t,e){var r,n;r=__utils__.findAll(t);n=[];Array.prototype.forEach.call(r,function(t){return n.push(t.tagName.toLowerCase())});return n};r=casper.evaluate(e,{_selector:t});return r};n=o(r);e=_.difference(n,t);return this.assert(e.length===0,"Expected "+r+" to have only tags "+t+", but there was"+("tag(s) "+e+" appeared"),"Expected "+r+" to have tags other than "+t+", but "+"those were the only tags that appeared")});l("textInDOM",function(){var t,e;e=this._obj;t=casper.evaluate(function(){return document.body.textContent||document.body.innerText});return this.assert(t.indexOf(e)!==-1,"expected text #{this} to be in the document, but it was not","expected text #{this} to not be in the document, but it was found")});h("textMatch",function(t){var e,r;e=this._obj;r=casper.fetchText(e);return this.assert(d(t,r),"expected '"+e+"' to match "+t+', but it was "'+r+'"',"expected '"+e+"' to not match "+t+", but it did")});l("trueOnRemote",function(){var t,e,r;t=this._obj;e=p(t);r=casper.evaluate(e);return this.assert(r,"expected expression "+this._obj+" to be true, but it was "+r,"expected expression "+this._obj+" to not be true, but itw as "+r)});return l("visible",function(){var t;t=this._obj;expect(t).to.be.inDOM;return this.assert(casper.visible(t),"expected selector #{this} to be visible, but it was not","expected selector #{this} to not be, but it was")})};if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){module.exports=t}else if(typeof define==="function"&&define.amd){define(function(){return t})}else{chai.use(t)}}).call(this);